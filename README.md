# gleam_contributors

A Gleam program that queries the Github v4 GraphQL API to request the [Gleam](https://github.com/gleam-lang) project's list of contributors and sponsors.


## Quick start

```sh
# Build the project
rebar3 compile

# Run the eunit tests
rebar3 eunit

# Run to enable escriptize IO commandline tooling
rebar3 escriptize

# Run the program!
_build/default/bin/gleam_contributors $TOKEN $FROM_VERSION $TO_VERSION

# Run the Erlang REPL (If required for debugging)
rebar3 shell
```


## Escriptize Usage

Running Escriptize creates an executable file:

`_build/default/bin/my_project_name` which requires a fn `main` as the entrypoint 

To make the api request, follow the filename by your [github api token](https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line), generated with the necessary permissions.

```sh
_build/default/bin/my_project_name $TOKEN $FROM_VERSION $TO_VERSION
```

Note that $TO_VERSION is optional, and will default to the current datetime if not given.

## To autogenerate a list of sponsors in file using Github Actions:

This will generate a list of everyone who sponsors you over $10 per month

1. Set up your repo to perform github actions (Link required)
2. Add your github token to the repo secrets (Link required)
1. In the root directory of the file you want to autogenerate, in folder `.github/workflows/` create a `yaml` file with the following code

```yml
name: Sponsors List 

# Controls when the action will run.
# Can set to on: push for example.
# This will run every 15 minutes!
on:
  schedule:
    - cron:  '*/15 * * * *'

jobs:
  readme_edit:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: gleam-lang/setup-erlang@v1.0.0
      with:
        otp-version: 22.1
    - uses: gleam-lang/setup-gleam@v1.0.1
      with:
        gleam-version: 0.9.0
    - name: Clones gleam_contributors
      run: |
        git clone https://github.com/scripttease/gleam_contributors.git
        cd gleam_contributors
        rebar3 install_deps
        rebar3 eunit
        gleam format --check src test
        rebar3 escriptize
    - name: Adds Sponors to README
      run: |
        gleam_contributors/_build/default/bin/gleam_contributors GA $API_TOKEN README.md 
    # Runs a set of commands using the runners shell
    - name: Commits and pushes updated README
      run: |
        git add README.md
        git config user.email scripttease@users.noreply.github.com
        git config user.name Al Dee
        git commit README.md -m 'Update README.md with test Cron job' || echo "Update README.md failed"
        git push origin || echo "Push Failed"

```

2. In the name of the file that you wish to put your sponsors list, add the following code (For example, in the README.md) Then COMMENT OUT THE LINE! The file should be a markdown file.

```md
Below this line this file is autogenerated 
```

3. If you wish to instead run the sponsors list generator from the command line use:

```sh
_build/default/bin/gleam_contributors GA $TOKEN $FILENAME
```

GA is a tag, it does not need to be in quotes. If you run the command from the root directory containing FILENAME.md, and if it has the commented out line shown above, the sponsor list will be generated as shown below as a series of avatar images.

```sh
# To generate sponsor list from command line:
rebar3 escriptize

_build/default/bin/gleam_contributors GA $TOKEN $FILENAME
```

<!-- Below this line this file is autogenerated -->
<a href="https://github.com/jamesmacaulay"><img src="https://avatars0.githubusercontent.com/u/340?u=548402d55a50538c0876880f15043e70a06d7fe9&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/michaeljones"><img src="https://avatars0.githubusercontent.com/u/5390?u=0db6b55765a8f037271092a19db060d70247dc62&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/josevalim"><img src="https://avatars0.githubusercontent.com/u/9582?u=c00cf4c84840538f31a3a8a46fec9dcc7b0ff132&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/ktec"><img src="https://avatars3.githubusercontent.com/u/28033?u=e24fcb89b8e2e290e4a06af97e7d6d10572a23d7&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/tsloughter"><img src="https://avatars2.githubusercontent.com/u/36227?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/eterps"><img src="https://avatars3.githubusercontent.com/u/39518?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/wojtekmach"><img src="https://avatars0.githubusercontent.com/u/76071?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/mroach"><img src="https://avatars0.githubusercontent.com/u/79006?u=56ae4c82735d35d7f9e59a9e2f9d472ca730a306&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/seanjensengrey"><img src="https://avatars2.githubusercontent.com/u/128454?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/rawkode"><img src="https://avatars1.githubusercontent.com/u/145816?u=3fd361fe7bc9d79e2f461d1a6963e9fab2aeae1d&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/benmyles"><img src="https://avatars3.githubusercontent.com/u/164675?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/ivarvong"><img src="https://avatars1.githubusercontent.com/u/183226?u=c1d9eb6a4c6947d16bf573be1276b3c743df1d0b&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/sorentwo"><img src="https://avatars0.githubusercontent.com/u/270831?u=3487cbeadcafdcdc8a4df003f2fb97d34edf8104&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/ericmj"><img src="https://avatars0.githubusercontent.com/u/316890?u=e50caf97a4a97f9ee547e58b90b4670bd5352379&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/Jwsonic"><img src="https://avatars2.githubusercontent.com/u/455046?u=0092bfecadfc3aac5e1df3145ea4e0a55a896787&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/hendi"><img src="https://avatars2.githubusercontent.com/u/550218?u=cadd63f892977ab606f219fd5f0e1d9e8100e039&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/slashmili"><img src="https://avatars1.githubusercontent.com/u/585764?u=31ad031fbc264429ec1fd0dd39593d6c3f5d2aad&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/MattCheely"><img src="https://avatars0.githubusercontent.com/u/604797?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/igagen"><img src="https://avatars3.githubusercontent.com/u/748593?u=eb762340e9b465a06470a9749b522b69bfe8eed7&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/hhandoko"><img src="https://avatars2.githubusercontent.com/u/771674?u=cb39115fb10e7e74b8533e136fb66d90fb66e37a&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/jechol"><img src="https://avatars0.githubusercontent.com/u/795125?u=cb92d9872e9b92c8f5f4e68feeccb845acbf34ec&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/shritesh"><img src="https://avatars1.githubusercontent.com/u/801803?u=bc34db4d8825131231b649d7ca857f9b478dab13&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/ggpasqualino"><img src="https://avatars3.githubusercontent.com/u/821260?v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/davydog187"><img src="https://avatars1.githubusercontent.com/u/1019721?u=66ffce0baadf67e8e8373e29509e0bf3eacb46b5&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/hsnyildiz"><img src="https://avatars3.githubusercontent.com/u/1096278?u=cc76b3a88b72a4e13d83bf8c2b7281e2c4ec7128&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/lawik"><img src="https://avatars0.githubusercontent.com/u/1971237?u=222ac5ebb788ceb72ce71e00f8a807e176485a56&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/bees"><img src="https://avatars2.githubusercontent.com/u/2433008?u=2e3dc40cae57ced745de8154974c8777e786c628&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/tlvenn"><img src="https://avatars2.githubusercontent.com/u/3340262?u=f08a32ca2352f4ee819eed5e1e2418b76cb5d76e&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/ontofractal"><img src="https://avatars2.githubusercontent.com/u/4211840?u=97aeb67208068d457fad522a500b62f12908270c&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/happysalada"><img src="https://avatars3.githubusercontent.com/u/5317234?u=37e2019ee3c4c0f35fb7aa259c0b14e18128fe7f&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/mvellandi"><img src="https://avatars3.githubusercontent.com/u/7730606?u=665d8ffba6af23b7ba8907b81e0a7ab963b40dbd&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/mario-mazo"><img src="https://avatars2.githubusercontent.com/u/30439204?u=9e078c81dc6de15587ac541706d12dc8de4134f3&v=4" style="border-radius: 100px" width="74"></a>
 <a href="https://github.com/starbelly"><img src="https://avatars0.githubusercontent.com/u/39971740?u=f234e6106097a35c95d4c6e4696ed966c09cac18&v=4" style="border-radius: 100px" width="74"></a>
 
